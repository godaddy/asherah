<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1898px" preserveAspectRatio="none" style="width:1106px;height:1898px;" version="1.1" viewBox="0 0 1106 1898" width="1106px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="1493.043" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="508" y="183.7305"/><rect fill="#FFFFFF" height="1419.1113" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="616.5" y="228.3516"/><rect fill="#FFFFFF" height="444.0371" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="927.5" y="442.2148"/><rect fill="#FFFFFF" height="272.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="927.5" y="1053.4941"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="35" x2="35" y1="65.4883" y2="1737.084"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="189" x2="189" y1="65.4883" y2="1737.084"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="346" x2="346" y1="65.4883" y2="1737.084"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="513" x2="513" y1="65.4883" y2="1737.084"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="621" x2="621" y1="65.4883" y2="1737.084"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="763.5" x2="763.5" y1="65.4883" y2="1737.084"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="932" x2="932" y1="65.4883" y2="1737.084"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1018" x2="1018" y1="65.4883" y2="1737.084"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1082" x2="1082" y1="65.4883" y2="1737.084"/><rect fill="#FEFECE" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="54" x="8" y="34"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="15" y="54.5352">Caller</text><rect fill="#FEFECE" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="54" x="8" y="1736.084"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="15" y="1756.6191">Caller</text><rect fill="#FEFECE" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="36" x="171" y="34"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="22" x="178" y="54.5352">API</text><rect fill="#FEFECE" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="36" x="171" y="1736.084"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="22" x="178" y="1756.6191">API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="292" y="62.5352">SessionFactory</text><path d="M325.5,21 L325.5,45 M325.5,33 L342.5,33 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354.5" cy="33" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="292" y="1749.6191">SessionFactory</text><path d="M325.5,1756.5723 L325.5,1780.5723 M325.5,1768.5723 L342.5,1768.5723 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354.5" cy="1768.5723" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="459" y="30"/><rect fill="#FEFECE" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="455" y="34"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="462" y="54.5352">Session Cache</text><rect fill="#FEFECE" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="459" y="1736.084"/><rect fill="#FEFECE" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="112" x="455" y="1740.084"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="462" y="1760.6191">Session Cache</text><rect fill="#FEFECE" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="585" y="30"/><rect fill="#FEFECE" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="581" y="34"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="588" y="54.5352">SK Cache</text><rect fill="#FEFECE" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="585" y="1736.084"/><rect fill="#FEFECE" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="581" y="1740.084"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="588" y="1760.6191">SK Cache</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="734.5" y="62.5352">Session</text><path d="M743,21 L743,45 M743,33 L760,33 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="772" cy="33" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="734.5" y="1749.6191">Session</text><path d="M743,1756.5723 L743,1780.5723 M743,1768.5723 L760,1768.5723 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="772" cy="1768.5723" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="73" x="898" y="30"/><rect fill="#FEFECE" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="73" x="894" y="34"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="901" y="54.5352">IK Cache</text><rect fill="#FEFECE" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="73" x="898" y="1736.084"/><rect fill="#FEFECE" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="73" x="894" y="1740.084"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="901" y="1760.6191">IK Cache</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="981" y="62.5352">Metastore</text><path d="M1000,13 C1000,3 1018,3 1018,3 C1018,3 1036,3 1036,13 L1036,39 C1036,49 1018,49 1018,49 C1018,49 1000,49 1000,39 L1000,13 " fill="#FEFECE" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1000,13 C1000,23 1018,23 1018,23 C1018,23 1036,23 1036,13 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="981" y="1749.6191">Metastore</text><path d="M1000,1762.5723 C1000,1752.5723 1018,1752.5723 1018,1752.5723 C1018,1752.5723 1036,1752.5723 1036,1762.5723 L1036,1788.5723 C1036,1798.5723 1018,1798.5723 1018,1798.5723 C1018,1798.5723 1000,1798.5723 1000,1788.5723 L1000,1762.5723 " fill="#FEFECE" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1000,1762.5723 C1000,1772.5723 1018,1772.5723 1018,1772.5723 C1018,1772.5723 1036,1772.5723 1036,1762.5723 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="1065" y="62.5352">KMS</text><ellipse cx="1082.5" cy="33" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1070.5" x2="1094.5" y1="47" y2="47"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="1065" y="1749.6191">KMS</text><ellipse cx="1082.5" cy="1768.5723" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1070.5" x2="1094.5" y1="1782.5723" y2="1782.5723"/><rect fill="#FFFFFF" height="1493.043" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="508" y="183.7305"/><rect fill="#FFFFFF" height="1419.1113" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="616.5" y="228.3516"/><rect fill="#FFFFFF" height="444.0371" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="927.5" y="442.2148"/><rect fill="#FFFFFF" height="272.4844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="927.5" y="1053.4941"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="231" y1="96.7988" y2="96.7988"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="231" x2="231" y1="96.7988" y2="109.7988"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="190" x2="231" y1="109.7988" y2="109.7988"/><polygon fill="#A80036" points="200,105.7988,190,109.7988,200,113.7988,196,109.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="196" y="92.0566">startup initiated</text><polygon fill="#A80036" points="334,135.1094,344,139.1094,334,143.1094,338,139.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="340" y1="139.1094" y2="139.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="196" y="134.3672">create new factory</text><polygon fill="#A80036" points="496,179.7305,506,183.7305,496,187.7305,500,183.7305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="502" y1="183.7305" y2="183.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="353" y="163.6777">create new</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="353" y="178.9883">Session cache</text><polygon fill="#A80036" points="604.5,224.3516,614.5,228.3516,604.5,232.3516,608.5,228.3516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="610.5" y1="228.3516" y2="228.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="353" y="208.2988">create new</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="353" y="223.6094">SK cache</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="231" y1="257.6621" y2="257.6621"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="231" x2="231" y1="257.6621" y2="270.6621"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="190" x2="231" y1="270.6621" y2="270.6621"/><polygon fill="#A80036" points="200,266.6621,190,270.6621,200,274.6621,196,270.6621" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="196" y="252.9199">startup completes</text><polygon fill="#A80036" points="177,320.9727,187,324.9727,177,328.9727,181,324.9727" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="35" x2="183" y1="324.9727" y2="324.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="42" y="320.2305">API call User 1</text><polygon fill="#A80036" points="334,350.2832,344,354.2832,334,358.2832,338,354.2832" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="340" y1="354.2832" y2="354.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="196" y="349.541">create new session</text><polygon fill="#A80036" points="496,379.5938,506,383.5938,496,387.5938,500,383.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="502" y1="383.5938" y2="383.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="353" y="378.8516">cache session</text><polygon fill="#A80036" points="751.5,408.9043,761.5,412.9043,751.5,416.9043,755.5,412.9043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="757.5" y1="412.9043" y2="412.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="353" y="408.1621">create new instance</text><polygon fill="#A80036" points="915.5,438.2148,925.5,442.2148,915.5,446.2148,919.5,442.2148" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="763.5" x2="921.5" y1="442.2148" y2="442.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="770.5" y="437.4727">create new IK cache</text><polygon fill="#A80036" points="751.5,467.5254,761.5,471.5254,751.5,475.5254,755.5,471.5254" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="757.5" y1="471.5254" y2="471.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="196" y="466.7832">operation 1</text><polygon fill="#A80036" points="1006,496.8359,1016,500.8359,1006,504.8359,1010,500.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="763.5" x2="1012" y1="500.8359" y2="500.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="770.5" y="496.0938">fetch IK</text><polygon fill="#A80036" points="1006,526.1465,1016,530.1465,1006,534.1465,1010,530.1465" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="763.5" x2="1012" y1="530.1465" y2="530.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="770.5" y="525.4043">fetch SK</text><polygon fill="#A80036" points="1070.5,555.457,1080.5,559.457,1070.5,563.457,1074.5,559.457" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="763.5" x2="1076.5" y1="559.457" y2="559.457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="770.5" y="554.7148">decrypt SK with MK</text><polygon fill="#A80036" points="637.5,584.7676,627.5,588.7676,637.5,592.7676,633.5,588.7676" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="631.5" x2="762.5" y1="588.7676" y2="588.7676"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="643.5" y="584.0254">cache SK</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="763.5" x2="805.5" y1="618.0781" y2="618.0781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="805.5" x2="805.5" y1="618.0781" y2="631.0781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="764.5" x2="805.5" y1="631.0781" y2="631.0781"/><polygon fill="#A80036" points="774.5,627.0781,764.5,631.0781,774.5,635.0781,770.5,631.0781" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="770.5" y="613.3359">decrypt IK with SK</text><polygon fill="#A80036" points="915.5,656.3887,925.5,660.3887,915.5,664.3887,919.5,660.3887" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="763.5" x2="921.5" y1="660.3887" y2="660.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="770.5" y="655.6465">cache IK</text><polygon fill="#A80036" points="200,685.6992,190,689.6992,200,693.6992,196,689.6992" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="194" x2="762.5" y1="689.6992" y2="689.6992"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="206" y="684.957">complete operation 1</text><polygon fill="#A80036" points="751.5,740.0098,761.5,744.0098,751.5,748.0098,755.5,744.0098" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="757.5" y1="744.0098" y2="744.0098"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="196" y="739.2676">operation 2</text><polygon fill="#A80036" points="915.5,769.3203,925.5,773.3203,915.5,777.3203,919.5,773.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="763.5" x2="921.5" y1="773.3203" y2="773.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="770.5" y="768.5781">get IK from cache</text><polygon fill="#A80036" points="200,798.6309,190,802.6309,200,806.6309,196,802.6309" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="194" x2="762.5" y1="802.6309" y2="802.6309"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="206" y="797.8887">complete operation 2</text><polygon fill="#A80036" points="751.5,852.9414,761.5,856.9414,751.5,860.9414,755.5,856.9414" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="757.5" y1="856.9414" y2="856.9414"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="196" y="852.1992">close session</text><polygon fill="#A80036" points="529,882.252,519,886.252,529,890.252,525,886.252" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="523" x2="762.5" y1="886.252" y2="886.252"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="535" y="881.5098">cache session</text><polygon fill="#A80036" points="46,911.5625,36,915.5625,46,919.5625,42,915.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="40" x2="188" y1="915.5625" y2="915.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="52" y="910.8203">API call User 1 result</text><polygon fill="#A80036" points="177,990.873,187,994.873,177,998.873,181,994.873" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="35" x2="183" y1="994.873" y2="994.873"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="42" y="990.1309">API call User 2</text><polygon fill="#A80036" points="334,1020.1836,344,1024.1836,334,1028.1836,338,1024.1836" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="340" y1="1024.1836" y2="1024.1836"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="196" y="1019.4414">create new session</text><polygon fill="#A80036" points="751.5,1049.4941,761.5,1053.4941,751.5,1057.4941,755.5,1053.4941" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="518" x2="757.5" y1="1053.4941" y2="1053.4941"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="525" y="1048.752">get cached session</text><polygon fill="#A80036" points="751.5,1078.8047,761.5,1082.8047,751.5,1086.8047,755.5,1082.8047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="757.5" y1="1082.8047" y2="1082.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="196" y="1078.0625">operation 1</text><polygon fill="#A80036" points="1006,1108.1152,1016,1112.1152,1006,1116.1152,1010,1112.1152" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="763.5" x2="1012" y1="1112.1152" y2="1112.1152"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="770.5" y="1107.373">fetch IK</text><polygon fill="#A80036" points="637.5,1137.4258,627.5,1141.4258,637.5,1145.4258,633.5,1141.4258" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="631.5" x2="762.5" y1="1141.4258" y2="1141.4258"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="643.5" y="1136.6836">get SK from cache</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="763.5" x2="805.5" y1="1170.7363" y2="1170.7363"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="805.5" x2="805.5" y1="1170.7363" y2="1183.7363"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="764.5" x2="805.5" y1="1183.7363" y2="1183.7363"/><polygon fill="#A80036" points="774.5,1179.7363,764.5,1183.7363,774.5,1187.7363,770.5,1183.7363" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="770.5" y="1165.9941">decrypt IK with SK</text><polygon fill="#A80036" points="915.5,1209.0469,925.5,1213.0469,915.5,1217.0469,919.5,1213.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="763.5" x2="921.5" y1="1213.0469" y2="1213.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="770.5" y="1208.3047">cache IK</text><polygon fill="#A80036" points="200,1238.3574,190,1242.3574,200,1246.3574,196,1242.3574" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="194" x2="762.5" y1="1242.3574" y2="1242.3574"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="206" y="1237.6152">complete operation 1</text><polygon fill="#A80036" points="751.5,1292.668,761.5,1296.668,751.5,1300.668,755.5,1296.668" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="757.5" y1="1296.668" y2="1296.668"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="196" y="1291.9258">close session</text><polygon fill="#A80036" points="529,1321.9785,519,1325.9785,529,1329.9785,525,1325.9785" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="523" x2="762.5" y1="1325.9785" y2="1325.9785"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="535" y="1321.2363">cache session</text><polygon fill="#A80036" points="46,1351.2891,36,1355.2891,46,1359.2891,42,1355.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="40" x2="188" y1="1355.2891" y2="1355.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="52" y="1350.5469">API call User 2 result</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="388" y1="1449.9102" y2="1449.9102"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="388" x2="388" y1="1449.9102" y2="1462.9102"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="388" y1="1462.9102" y2="1462.9102"/><polygon fill="#A80036" points="357,1458.9102,347,1462.9102,357,1466.9102,353,1462.9102" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="353" y="1429.8574">session cache</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="353" y="1445.168">expire timeout triggered</text><polygon fill="#A80036" points="496,1488.2207,506,1492.2207,496,1496.2207,500,1492.2207" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="502" y1="1492.2207" y2="1492.2207"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="353" y="1487.4785">expire session</text><polygon fill="#A80036" points="920.5,1517.5313,930.5,1521.5313,920.5,1525.5313,924.5,1521.5313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="763.5" x2="926.5" y1="1521.5313" y2="1521.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="770.5" y="1516.7891">securely close IK cache</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="923.5" x2="941.5" y1="1512.5313" y2="1530.5313"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="923.5" x2="941.5" y1="1530.5313" y2="1512.5313"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="231" y1="1575.8418" y2="1575.8418"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="231" x2="231" y1="1575.8418" y2="1588.8418"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="190" x2="231" y1="1588.8418" y2="1588.8418"/><polygon fill="#A80036" points="200,1584.8418,190,1588.8418,200,1592.8418,196,1588.8418" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="196" y="1571.0996">shutdown initiated</text><polygon fill="#A80036" points="334,1614.1523,344,1618.1523,334,1622.1523,338,1618.1523" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="340" y1="1618.1523" y2="1618.1523"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="196" y="1613.4102">close session factory</text><polygon fill="#A80036" points="609.5,1643.4629,619.5,1647.4629,609.5,1651.4629,613.5,1647.4629" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="615.5" y1="1647.4629" y2="1647.4629"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="353" y="1642.7207">securely close SK cache</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="612.5" x2="630.5" y1="1638.4629" y2="1656.4629"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="612.5" x2="630.5" y1="1656.4629" y2="1638.4629"/><polygon fill="#A80036" points="501,1672.7734,511,1676.7734,501,1680.7734,505,1676.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="507" y1="1676.7734" y2="1676.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="353" y="1672.0313">close Session cache</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="504" x2="522" y1="1667.7734" y2="1685.7734"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="504" x2="522" y1="1685.7734" y2="1667.7734"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="231" y1="1706.084" y2="1706.084"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="231" x2="231" y1="1706.084" y2="1719.084"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="190" x2="231" y1="1719.084" y2="1719.084"/><polygon fill="#A80036" points="200,1715.084,190,1719.084,200,1723.084,196,1719.084" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="196" y="1701.3418">shutdown completes</text><rect fill="#DDDDDD" height="79.9531" rx="5" ry="5" style="stroke: #000000; stroke-width: 1.0;" width="297" x="11" y="1807.5723"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35" x="22" y="1828.1074">Type</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="83" x="67" y="1828.1074">Description</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="21" y="1844.5957">MK</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="208" x="66" y="1844.5957">Master Key, root key from KMS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="17" x="21" y="1861.084">SK</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="197" x="66" y="1861.084">System Key, encrypted by MK</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="13" x="21" y="1877.5723">IK</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="232" x="66" y="1877.5723">Intermediate Key, encrypted by SK</text><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="302" y1="1814.5723" y2="1814.5723"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="302" y1="1831.0605" y2="1831.0605"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="302" y1="1847.5488" y2="1847.5488"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="302" y1="1864.0371" y2="1864.0371"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="302" y1="1880.5254" y2="1880.5254"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="17" y1="1814.5723" y2="1880.5254"/><line style="stroke: #000000; stroke-width: 1.0;" x1="62" x2="62" y1="1814.5723" y2="1880.5254"/><line style="stroke: #000000; stroke-width: 1.0;" x1="302" x2="302" y1="1814.5723" y2="1880.5254"/><!--MD5=[14de6fd2f413f1ecc9bf18072d280005]
@startuml

skinparam shadowing false

legend left
|= Type |= Description |
| MK | Master Key, root key from KMS |
| SK | System Key, encrypted by MK |
| IK | Intermediate Key, encrypted by SK |
endlegend

participant Caller
participant API
boundary SessionFactory
collections "Session Cache"
collections "SK Cache"
boundary Session
collections "IK Cache"
database Metastore
entity KMS

API -> API : startup initiated
API -> SessionFactory : create new factory
SessionFactory -> "Session Cache" : create new \nSession cache
activate "Session Cache"
SessionFactory -> "SK Cache" : create new \nSK cache
activate "SK Cache"
API -> API : startup completes
|||
Caller -> API : API call User 1
API -> SessionFactory : create new session
SessionFactory -> "Session Cache" : cache session
SessionFactory -> Session : create new instance
Session -> "IK Cache" : create new IK cache
activate "IK Cache"
API -> Session : operation 1
Session -> Metastore : fetch IK
Session -> Metastore : fetch SK
Session -> KMS : decrypt SK with MK
Session -> "SK Cache" : cache SK
Session -> Session : decrypt IK with SK
Session -> "IK Cache" : cache IK
Session -> API : complete operation 1
|||
API -> Session : operation 2
Session -> "IK Cache" : get IK from cache
Session -> API : complete operation 2
|||
API -> Session : close session
Session -> "Session Cache" : cache session
deactivate "IK Cache"
API -> Caller : API call User 1 result
|||
|||
Caller -> API : API call User 2
API -> SessionFactory : create new session
"Session Cache" -> Session : get cached session
activate "IK Cache"
API -> Session : operation 1
Session -> Metastore : fetch IK
Session -> "SK Cache" : get SK from cache
Session -> Session : decrypt IK with SK
Session -> "IK Cache" : cache IK
Session -> API : complete operation 1
|||
API -> Session : close session
Session -> "Session Cache" : cache session
deactivate "IK Cache"
API -> Caller : API call User 2 result
|||
|||
SessionFactory -> SessionFactory : session cache \nexpire timeout triggered
SessionFactory -> "Session Cache" : expire session
Session -> "IK Cache" : securely close IK cache
destroy "IK Cache"
|||
API -> API : shutdown initiated
API -> SessionFactory : close session factory
SessionFactory -> "SK Cache" : securely close SK cache
destroy "SK Cache"
SessionFactory -> "Session Cache" : close Session cache
destroy "Session Cache"
API -> API : shutdown completes

@enduml

PlantUML version 1.2020.00(Sat Jan 11 04:30:53 PST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_192-b12
Operating System: Mac OS X
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>