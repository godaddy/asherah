<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1904px" preserveAspectRatio="none" style="width:1122px;height:1904px;" version="1.1" viewBox="0 0 1122 1904" width="1122px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="1500.7109" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="510" y="182.8281"/><rect fill="#FFFFFF" height="1427.3125" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="622.5" y="227.0938"/><rect fill="#FFFFFF" height="441.7266" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="940.5" y="439.8906"/><rect fill="#FFFFFF" height="271.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="940.5" y="1063.2813"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="34" x2="34" y1="65.2969" y2="1743.6719"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="188.5" x2="188.5" y1="65.2969" y2="1743.6719"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="345.5" x2="345.5" y1="65.2969" y2="1743.6719"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="514.5" x2="514.5" y1="65.2969" y2="1743.6719"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="627.5" x2="627.5" y1="65.2969" y2="1743.6719"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="774" x2="774" y1="65.2969" y2="1743.6719"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="945.5" x2="945.5" y1="65.2969" y2="1743.6719"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1032.5" x2="1032.5" y1="65.2969" y2="1743.6719"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1098.5" x2="1098.5" y1="65.2969" y2="1743.6719"/><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="52" x="8" y="34"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="15" y="53.9951">Caller</text><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="52" x="8" y="1742.6719"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="15" y="1762.667">Caller</text><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="35" x="171.5" y="34"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="178.5" y="53.9951">API</text><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="35" x="171.5" y="1742.6719"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="178.5" y="1762.667">API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="290.5" y="61.9951">SessionFactory</text><path d="M325.5,21 L325.5,45 M325.5,33 L342.5,33 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354.5" cy="33" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="290.5" y="1755.667">SessionFactory</text><path d="M325.5,1762.9688 L325.5,1786.9688 M325.5,1774.9688 L342.5,1774.9688 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354.5" cy="1774.9688" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="458.5" y="30"/><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="454.5" y="34"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="461.5" y="53.9951">Session Cache</text><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="458.5" y="1742.6719"/><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="454.5" y="1746.6719"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="461.5" y="1766.667">Session Cache</text><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="589.5" y="30"/><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="585.5" y="34"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="592.5" y="53.9951">SK Cache</text><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="589.5" y="1742.6719"/><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="585.5" y="1746.6719"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="592.5" y="1766.667">SK Cache</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="744" y="61.9951">Session</text><path d="M754,21 L754,45 M754,33 L771,33 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="783" cy="33" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="744" y="1755.667">Session</text><path d="M754,1762.9688 L754,1786.9688 M754,1774.9688 L771,1774.9688 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="783" cy="1774.9688" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="74" x="910.5" y="30"/><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="74" x="906.5" y="34"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="913.5" y="53.9951">IK Cache</text><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="74" x="910.5" y="1742.6719"/><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="74" x="906.5" y="1746.6719"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="913.5" y="1766.667">IK Cache</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="994.5" y="61.9951">Metastore</text><path d="M1014.5,13 C1014.5,3 1032.5,3 1032.5,3 C1032.5,3 1050.5,3 1050.5,13 L1050.5,39 C1050.5,49 1032.5,49 1032.5,49 C1032.5,49 1014.5,49 1014.5,39 L1014.5,13 " fill="#FEFECE" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1014.5,13 C1014.5,23 1032.5,23 1032.5,23 C1032.5,23 1050.5,23 1050.5,13 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="994.5" y="1755.667">Metastore</text><path d="M1014.5,1768.9688 C1014.5,1758.9688 1032.5,1758.9688 1032.5,1758.9688 C1032.5,1758.9688 1050.5,1758.9688 1050.5,1768.9688 L1050.5,1794.9688 C1050.5,1804.9688 1032.5,1804.9688 1032.5,1804.9688 C1032.5,1804.9688 1014.5,1804.9688 1014.5,1794.9688 L1014.5,1768.9688 " fill="#FEFECE" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1014.5,1768.9688 C1014.5,1778.9688 1032.5,1778.9688 1032.5,1778.9688 C1032.5,1778.9688 1050.5,1778.9688 1050.5,1768.9688 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="1080.5" y="61.9951">KMS</text><ellipse cx="1098.5" cy="33" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1086.5" x2="1110.5" y1="47" y2="47"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="1080.5" y="1755.667">KMS</text><ellipse cx="1098.5" cy="1774.9688" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1086.5" x2="1110.5" y1="1788.9688" y2="1788.9688"/><rect fill="#FFFFFF" height="1500.7109" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="510" y="182.8281"/><rect fill="#FFFFFF" height="1427.3125" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="622.5" y="227.0938"/><rect fill="#FFFFFF" height="441.7266" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="940.5" y="439.8906"/><rect fill="#FFFFFF" height="271.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="940.5" y="1063.2813"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="231" y1="96.4297" y2="96.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="231" x2="231" y1="96.4297" y2="109.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="190" x2="231" y1="109.4297" y2="109.4297"/><polygon fill="#A80036" points="200,105.4297,190,109.4297,200,113.4297,196,109.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="196" y="91.3638">startup initiated</text><polygon fill="#A80036" points="334,134.5625,344,138.5625,334,142.5625,338,138.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="340" y1="138.5625" y2="138.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="196" y="133.4966">create new factory</text><polygon fill="#A80036" points="498,178.8281,508,182.8281,498,186.8281,502,182.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="504" y1="182.8281" y2="182.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="353" y="162.6294">create new</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="353" y="177.7622">Session cache</text><polygon fill="#A80036" points="610.5,223.0938,620.5,227.0938,610.5,231.0938,614.5,227.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="616.5" y1="227.0938" y2="227.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="353" y="206.895">create new</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="353" y="222.0278">SK cache</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="231" y1="256.2266" y2="256.2266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="231" x2="231" y1="256.2266" y2="269.2266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="190" x2="231" y1="269.2266" y2="269.2266"/><polygon fill="#A80036" points="200,265.2266,190,269.2266,200,273.2266,196,269.2266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="196" y="251.1606">startup completes</text><polygon fill="#A80036" points="177,319.3594,187,323.3594,177,327.3594,181,323.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="34" x2="183" y1="323.3594" y2="323.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="41" y="318.2935">API call User 1</text><polygon fill="#A80036" points="334,348.4922,344,352.4922,334,356.4922,338,352.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="340" y1="352.4922" y2="352.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="196" y="347.4263">create new session</text><polygon fill="#A80036" points="762.5,377.625,772.5,381.625,762.5,385.625,766.5,381.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="768.5" y1="381.625" y2="381.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="353" y="376.5591">create new instance</text><polygon fill="#A80036" points="498,406.7578,508,410.7578,498,414.7578,502,410.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="504" y1="410.7578" y2="410.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="353" y="405.6919">cache session</text><polygon fill="#A80036" points="928.5,435.8906,938.5,439.8906,928.5,443.8906,932.5,439.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="934.5" y1="439.8906" y2="439.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="781.5" y="434.8247">create new IK cache</text><polygon fill="#A80036" points="762.5,465.0234,772.5,469.0234,762.5,473.0234,766.5,469.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="768.5" y1="469.0234" y2="469.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="196" y="463.9575">operation 1</text><polygon fill="#A80036" points="1020.5,494.1563,1030.5,498.1563,1020.5,502.1563,1024.5,498.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="1026.5" y1="498.1563" y2="498.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="781.5" y="493.0903">fetch IK</text><polygon fill="#A80036" points="1020.5,523.2891,1030.5,527.2891,1020.5,531.2891,1024.5,527.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="1026.5" y1="527.2891" y2="527.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="781.5" y="522.2231">fetch SK</text><polygon fill="#A80036" points="1086.5,552.4219,1096.5,556.4219,1086.5,560.4219,1090.5,556.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="1092.5" y1="556.4219" y2="556.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="781.5" y="551.356">decrypt SK with MK</text><polygon fill="#A80036" points="643.5,581.5547,633.5,585.5547,643.5,589.5547,639.5,585.5547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="637.5" x2="773.5" y1="585.5547" y2="585.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="649.5" y="580.4888">cache SK</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="816.5" y1="614.6875" y2="614.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="816.5" x2="816.5" y1="614.6875" y2="627.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="775.5" x2="816.5" y1="627.6875" y2="627.6875"/><polygon fill="#A80036" points="785.5,623.6875,775.5,627.6875,785.5,631.6875,781.5,627.6875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="781.5" y="609.6216">decrypt IK with SK</text><polygon fill="#A80036" points="928.5,652.8203,938.5,656.8203,928.5,660.8203,932.5,656.8203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="934.5" y1="656.8203" y2="656.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="781.5" y="651.7544">cache IK</text><polygon fill="#A80036" points="200,681.9531,190,685.9531,200,689.9531,196,685.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="194" x2="773.5" y1="685.9531" y2="685.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="206" y="680.8872">complete operation 1</text><polygon fill="#A80036" points="762.5,736.0859,772.5,740.0859,762.5,744.0859,766.5,740.0859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="768.5" y1="740.0859" y2="740.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="196" y="735.02">operation 2</text><polygon fill="#A80036" points="928.5,765.2188,938.5,769.2188,928.5,773.2188,932.5,769.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="934.5" y1="769.2188" y2="769.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="781.5" y="764.1528">get IK from cache</text><polygon fill="#A80036" points="200,794.3516,190,798.3516,200,802.3516,196,798.3516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="194" x2="773.5" y1="798.3516" y2="798.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="206" y="793.2856">complete operation 2</text><polygon fill="#A80036" points="762.5,848.4844,772.5,852.4844,762.5,856.4844,766.5,852.4844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="768.5" y1="852.4844" y2="852.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="196" y="847.4185">close session</text><polygon fill="#A80036" points="531,877.6172,521,881.6172,531,885.6172,527,881.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="525" x2="773.5" y1="881.6172" y2="881.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="537" y="876.5513">update Session cache</text><polygon fill="#A80036" points="45,906.75,35,910.75,45,914.75,41,910.75" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="39" x2="188" y1="910.75" y2="910.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="51" y="905.6841">API call User 1 result</text><polygon fill="#A80036" points="177,985.8828,187,989.8828,177,993.8828,181,989.8828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="34" x2="183" y1="989.8828" y2="989.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="41" y="984.8169">API call User 2</text><polygon fill="#A80036" points="334,1015.0156,344,1019.0156,334,1023.0156,338,1019.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="340" y1="1019.0156" y2="1019.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="196" y="1013.9497">create new session</text><polygon fill="#A80036" points="762.5,1059.2813,772.5,1063.2813,762.5,1067.2813,766.5,1063.2813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="520" x2="768.5" y1="1063.2813" y2="1063.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="527" y="1043.0825">get cached session if available</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="527" y="1058.2153">else create new instance</text><polygon fill="#A80036" points="762.5,1088.4141,772.5,1092.4141,762.5,1096.4141,766.5,1092.4141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="768.5" y1="1092.4141" y2="1092.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="196" y="1087.3481">operation 1</text><polygon fill="#A80036" points="1020.5,1117.5469,1030.5,1121.5469,1020.5,1125.5469,1024.5,1121.5469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="1026.5" y1="1121.5469" y2="1121.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="781.5" y="1116.481">fetch IK</text><polygon fill="#A80036" points="643.5,1146.6797,633.5,1150.6797,643.5,1154.6797,639.5,1150.6797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="637.5" x2="773.5" y1="1150.6797" y2="1150.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="649.5" y="1145.6138">get SK from cache</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="816.5" y1="1179.8125" y2="1179.8125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="816.5" x2="816.5" y1="1179.8125" y2="1192.8125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="775.5" x2="816.5" y1="1192.8125" y2="1192.8125"/><polygon fill="#A80036" points="785.5,1188.8125,775.5,1192.8125,785.5,1196.8125,781.5,1192.8125" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="781.5" y="1174.7466">decrypt IK with SK</text><polygon fill="#A80036" points="928.5,1217.9453,938.5,1221.9453,928.5,1225.9453,932.5,1221.9453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="934.5" y1="1221.9453" y2="1221.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="781.5" y="1216.8794">cache IK</text><polygon fill="#A80036" points="200,1247.0781,190,1251.0781,200,1255.0781,196,1251.0781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="194" x2="773.5" y1="1251.0781" y2="1251.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="206" y="1246.0122">complete operation 1</text><polygon fill="#A80036" points="762.5,1301.2109,772.5,1305.2109,762.5,1309.2109,766.5,1305.2109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="768.5" y1="1305.2109" y2="1305.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="196" y="1300.145">close session</text><polygon fill="#A80036" points="531,1330.3438,521,1334.3438,531,1338.3438,527,1334.3438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="525" x2="773.5" y1="1334.3438" y2="1334.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="537" y="1329.2778">update Session cache</text><polygon fill="#A80036" points="45,1359.4766,35,1363.4766,45,1367.4766,41,1363.4766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="39" x2="188" y1="1363.4766" y2="1363.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="51" y="1358.4106">API call User 2 result</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="388" y1="1457.7422" y2="1457.7422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="388" x2="388" y1="1457.7422" y2="1470.7422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="388" y1="1470.7422" y2="1470.7422"/><polygon fill="#A80036" points="357,1466.7422,347,1470.7422,357,1474.7422,353,1470.7422" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="353" y="1437.5435">session cache</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="353" y="1452.6763">expire timeout triggered</text><polygon fill="#A80036" points="498,1495.875,508,1499.875,498,1503.875,502,1499.875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="504" y1="1499.875" y2="1499.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="353" y="1494.8091">expire session</text><polygon fill="#A80036" points="933.5,1525.0078,943.5,1529.0078,933.5,1533.0078,937.5,1529.0078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="939.5" y1="1529.0078" y2="1529.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="781.5" y="1523.9419">securely close IK cache</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="936.5" x2="954.5" y1="1520.0078" y2="1538.0078"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="936.5" x2="954.5" y1="1538.0078" y2="1520.0078"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="231" y1="1583.1406" y2="1583.1406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="231" x2="231" y1="1583.1406" y2="1596.1406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="190" x2="231" y1="1596.1406" y2="1596.1406"/><polygon fill="#A80036" points="200,1592.1406,190,1596.1406,200,1600.1406,196,1596.1406" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="196" y="1578.0747">shutdown initiated</text><polygon fill="#A80036" points="334,1621.2734,344,1625.2734,334,1629.2734,338,1625.2734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="340" y1="1625.2734" y2="1625.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="196" y="1620.2075">close session factory</text><polygon fill="#A80036" points="615.5,1650.4063,625.5,1654.4063,615.5,1658.4063,619.5,1654.4063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="621.5" y1="1654.4063" y2="1654.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="353" y="1649.3403">securely close SK cache</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="618.5" x2="636.5" y1="1645.4063" y2="1663.4063"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="618.5" x2="636.5" y1="1663.4063" y2="1645.4063"/><polygon fill="#A80036" points="503,1679.5391,513,1683.5391,503,1687.5391,507,1683.5391" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="509" y1="1683.5391" y2="1683.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="353" y="1678.4731">close Session cache</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="506" x2="524" y1="1674.5391" y2="1692.5391"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="506" x2="524" y1="1692.5391" y2="1674.5391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="231" y1="1712.6719" y2="1712.6719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="231" x2="231" y1="1712.6719" y2="1725.6719"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="190" x2="231" y1="1725.6719" y2="1725.6719"/><polygon fill="#A80036" points="200,1721.6719,190,1725.6719,200,1729.6719,196,1725.6719" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="196" y="1707.606">shutdown completes</text><rect fill="#DDDDDD" height="79.1875" rx="5" ry="5" style="stroke: #000000; stroke-width: 1.0;" width="305" x="11" y="1813.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="22" y="1833.9639">Type</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="71" y="1833.9639">Description</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="21" y="1850.2607">MK</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="209" x="70" y="1850.2607">Master Key, root key from KMS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="18" x="21" y="1866.5576">SK</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="203" x="70" y="1866.5576">System Key, encrypted by MK</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="12" x="21" y="1882.8545">IK</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="236" x="70" y="1882.8545">Intermediate Key, encrypted by SK</text><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="310" y1="1820.9688" y2="1820.9688"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="310" y1="1837.2656" y2="1837.2656"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="310" y1="1853.5625" y2="1853.5625"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="310" y1="1869.8594" y2="1869.8594"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="310" y1="1886.1563" y2="1886.1563"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="17" y1="1820.9688" y2="1886.1563"/><line style="stroke: #000000; stroke-width: 1.0;" x1="66" x2="66" y1="1820.9688" y2="1886.1563"/><line style="stroke: #000000; stroke-width: 1.0;" x1="310" x2="310" y1="1820.9688" y2="1886.1563"/><!--MD5=[f84d47432b5c67ca046491d204a33a2b]
@startuml

skinparam shadowing false

legend left
|= Type |= Description |
| MK | Master Key, root key from KMS |
| SK | System Key, encrypted by MK |
| IK | Intermediate Key, encrypted by SK |
endlegend

participant Caller
participant API
boundary SessionFactory
collections "Session Cache"
collections "SK Cache"
boundary Session
collections "IK Cache"
database Metastore
entity KMS

API -> API : startup initiated
API -> SessionFactory : create new factory
SessionFactory -> "Session Cache" : create new \nSession cache
activate "Session Cache"
SessionFactory -> "SK Cache" : create new \nSK cache
activate "SK Cache"
API -> API : startup completes
|||
Caller -> API : API call User 1
API -> SessionFactory : create new session
SessionFactory -> Session : create new instance
SessionFactory -> "Session Cache" : cache session
Session -> "IK Cache" : create new IK cache
activate "IK Cache"
API -> Session : operation 1
Session -> Metastore : fetch IK
Session -> Metastore : fetch SK
Session -> KMS : decrypt SK with MK
Session -> "SK Cache" : cache SK
Session -> Session : decrypt IK with SK
Session -> "IK Cache" : cache IK
Session -> API : complete operation 1
|||
API -> Session : operation 2
Session -> "IK Cache" : get IK from cache
Session -> API : complete operation 2
|||
API -> Session : close session
Session -> "Session Cache" : update Session cache
deactivate "IK Cache"
API -> Caller : API call User 1 result
|||
|||
Caller -> API : API call User 2
API -> SessionFactory : create new session
"Session Cache" -> Session : get cached session if available\nelse create new instance
activate "IK Cache"
API -> Session : operation 1
Session -> Metastore : fetch IK
Session -> "SK Cache" : get SK from cache
Session -> Session : decrypt IK with SK
Session -> "IK Cache" : cache IK
Session -> API : complete operation 1
|||
API -> Session : close session
Session -> "Session Cache" : update Session cache
deactivate "IK Cache"
API -> Caller : API call User 2 result
|||
|||
SessionFactory -> SessionFactory : session cache \nexpire timeout triggered
SessionFactory -> "Session Cache" : expire session
Session -> "IK Cache" : securely close IK cache
destroy "IK Cache"
|||
API -> API : shutdown initiated
API -> SessionFactory : close session factory
SessionFactory -> "SK Cache" : securely close SK cache
destroy "SK Cache"
SessionFactory -> "Session Cache" : close Session cache
destroy "Session Cache"
API -> API : shutdown completes

@enduml

PlantUML version 1.2019.11(Sun Sep 22 10:02:15 GMT 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 14-ea+15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>
