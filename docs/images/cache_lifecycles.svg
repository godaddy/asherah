<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1889px" preserveAspectRatio="none" style="width:1122px;height:1889px;" version="1.1" viewBox="0 0 1122 1889" width="1122px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="1485.5781" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="510" y="182.8281"/><rect fill="#FFFFFF" height="1412.1797" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="622.5" y="227.0938"/><rect fill="#FFFFFF" height="441.7266" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="940.5" y="439.8906"/><rect fill="#FFFFFF" height="271.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="940.5" y="1048.1484"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="34" x2="34" y1="65.2969" y2="1728.5391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="188.5" x2="188.5" y1="65.2969" y2="1728.5391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="345.5" x2="345.5" y1="65.2969" y2="1728.5391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="514.5" x2="514.5" y1="65.2969" y2="1728.5391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="627.5" x2="627.5" y1="65.2969" y2="1728.5391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="774" x2="774" y1="65.2969" y2="1728.5391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="945.5" x2="945.5" y1="65.2969" y2="1728.5391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1032.5" x2="1032.5" y1="65.2969" y2="1728.5391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1098.5" x2="1098.5" y1="65.2969" y2="1728.5391"/><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="52" x="8" y="34"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="15" y="53.9951">Caller</text><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="52" x="8" y="1727.5391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="15" y="1747.5342">Caller</text><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="35" x="171.5" y="34"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="178.5" y="53.9951">API</text><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="35" x="171.5" y="1727.5391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="178.5" y="1747.5342">API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="290.5" y="61.9951">SessionFactory</text><path d="M325.5,21 L325.5,45 M325.5,33 L342.5,33 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354.5" cy="33" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="290.5" y="1740.5342">SessionFactory</text><path d="M325.5,1747.8359 L325.5,1771.8359 M325.5,1759.8359 L342.5,1759.8359 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="354.5" cy="1759.8359" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="458.5" y="30"/><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="454.5" y="34"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="461.5" y="53.9951">Session Cache</text><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="458.5" y="1727.5391"/><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="454.5" y="1731.5391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="461.5" y="1751.5342">Session Cache</text><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="589.5" y="30"/><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="585.5" y="34"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="592.5" y="53.9951">SK Cache</text><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="589.5" y="1727.5391"/><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="585.5" y="1731.5391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="592.5" y="1751.5342">SK Cache</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="744" y="61.9951">Session</text><path d="M754,21 L754,45 M754,33 L771,33 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="783" cy="33" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="55" x="744" y="1740.5342">Session</text><path d="M754,1747.8359 L754,1771.8359 M754,1759.8359 L771,1759.8359 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="783" cy="1759.8359" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="74" x="910.5" y="30"/><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="74" x="906.5" y="34"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="913.5" y="53.9951">IK Cache</text><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="74" x="910.5" y="1727.5391"/><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="74" x="906.5" y="1731.5391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="913.5" y="1751.5342">IK Cache</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="994.5" y="61.9951">Metastore</text><path d="M1014.5,13 C1014.5,3 1032.5,3 1032.5,3 C1032.5,3 1050.5,3 1050.5,13 L1050.5,39 C1050.5,49 1032.5,49 1032.5,49 C1032.5,49 1014.5,49 1014.5,39 L1014.5,13 " fill="#FEFECE" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1014.5,13 C1014.5,23 1032.5,23 1032.5,23 C1032.5,23 1050.5,23 1050.5,13 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="994.5" y="1740.5342">Metastore</text><path d="M1014.5,1753.8359 C1014.5,1743.8359 1032.5,1743.8359 1032.5,1743.8359 C1032.5,1743.8359 1050.5,1743.8359 1050.5,1753.8359 L1050.5,1779.8359 C1050.5,1789.8359 1032.5,1789.8359 1032.5,1789.8359 C1032.5,1789.8359 1014.5,1789.8359 1014.5,1779.8359 L1014.5,1753.8359 " fill="#FEFECE" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1014.5,1753.8359 C1014.5,1763.8359 1032.5,1763.8359 1032.5,1763.8359 C1032.5,1763.8359 1050.5,1763.8359 1050.5,1753.8359 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="1080.5" y="61.9951">KMS</text><ellipse cx="1098.5" cy="33" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1086.5" x2="1110.5" y1="47" y2="47"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="1080.5" y="1740.5342">KMS</text><ellipse cx="1098.5" cy="1759.8359" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1086.5" x2="1110.5" y1="1773.8359" y2="1773.8359"/><rect fill="#FFFFFF" height="1485.5781" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="510" y="182.8281"/><rect fill="#FFFFFF" height="1412.1797" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="622.5" y="227.0938"/><rect fill="#FFFFFF" height="441.7266" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="940.5" y="439.8906"/><rect fill="#FFFFFF" height="271.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="940.5" y="1048.1484"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="231" y1="96.4297" y2="96.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="231" x2="231" y1="96.4297" y2="109.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="190" x2="231" y1="109.4297" y2="109.4297"/><polygon fill="#A80036" points="200,105.4297,190,109.4297,200,113.4297,196,109.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="196" y="91.3638">startup initiated</text><polygon fill="#A80036" points="334,134.5625,344,138.5625,334,142.5625,338,138.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="340" y1="138.5625" y2="138.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="196" y="133.4966">create new factory</text><polygon fill="#A80036" points="498,178.8281,508,182.8281,498,186.8281,502,182.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="504" y1="182.8281" y2="182.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="353" y="162.6294">create new</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="353" y="177.7622">Session cache</text><polygon fill="#A80036" points="610.5,223.0938,620.5,227.0938,610.5,231.0938,614.5,227.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="616.5" y1="227.0938" y2="227.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="353" y="206.895">create new</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="353" y="222.0278">SK cache</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="231" y1="256.2266" y2="256.2266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="231" x2="231" y1="256.2266" y2="269.2266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="190" x2="231" y1="269.2266" y2="269.2266"/><polygon fill="#A80036" points="200,265.2266,190,269.2266,200,273.2266,196,269.2266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="196" y="251.1606">startup completes</text><polygon fill="#A80036" points="177,319.3594,187,323.3594,177,327.3594,181,323.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="34" x2="183" y1="323.3594" y2="323.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="41" y="318.2935">API call User 1</text><polygon fill="#A80036" points="334,348.4922,344,352.4922,334,356.4922,338,352.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="340" y1="352.4922" y2="352.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="196" y="347.4263">create new session</text><polygon fill="#A80036" points="498,377.625,508,381.625,498,385.625,502,381.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="504" y1="381.625" y2="381.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="353" y="376.5591">cache session</text><polygon fill="#A80036" points="762.5,406.7578,772.5,410.7578,762.5,414.7578,766.5,410.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="768.5" y1="410.7578" y2="410.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="353" y="405.6919">create new instance</text><polygon fill="#A80036" points="928.5,435.8906,938.5,439.8906,928.5,443.8906,932.5,439.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="934.5" y1="439.8906" y2="439.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="781.5" y="434.8247">create new IK cache</text><polygon fill="#A80036" points="762.5,465.0234,772.5,469.0234,762.5,473.0234,766.5,469.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="768.5" y1="469.0234" y2="469.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="196" y="463.9575">operation 1</text><polygon fill="#A80036" points="1020.5,494.1563,1030.5,498.1563,1020.5,502.1563,1024.5,498.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="1026.5" y1="498.1563" y2="498.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="781.5" y="493.0903">fetch IK</text><polygon fill="#A80036" points="1020.5,523.2891,1030.5,527.2891,1020.5,531.2891,1024.5,527.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="1026.5" y1="527.2891" y2="527.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="781.5" y="522.2231">fetch SK</text><polygon fill="#A80036" points="1086.5,552.4219,1096.5,556.4219,1086.5,560.4219,1090.5,556.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="1092.5" y1="556.4219" y2="556.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="781.5" y="551.356">decrypt SK with MK</text><polygon fill="#A80036" points="643.5,581.5547,633.5,585.5547,643.5,589.5547,639.5,585.5547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="637.5" x2="773.5" y1="585.5547" y2="585.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="649.5" y="580.4888">cache SK</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="816.5" y1="614.6875" y2="614.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="816.5" x2="816.5" y1="614.6875" y2="627.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="775.5" x2="816.5" y1="627.6875" y2="627.6875"/><polygon fill="#A80036" points="785.5,623.6875,775.5,627.6875,785.5,631.6875,781.5,627.6875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="781.5" y="609.6216">decrypt IK with SK</text><polygon fill="#A80036" points="928.5,652.8203,938.5,656.8203,928.5,660.8203,932.5,656.8203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="934.5" y1="656.8203" y2="656.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="781.5" y="651.7544">cache IK</text><polygon fill="#A80036" points="200,681.9531,190,685.9531,200,689.9531,196,685.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="194" x2="773.5" y1="685.9531" y2="685.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="206" y="680.8872">complete operation 1</text><polygon fill="#A80036" points="762.5,736.0859,772.5,740.0859,762.5,744.0859,766.5,740.0859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="768.5" y1="740.0859" y2="740.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="196" y="735.02">operation 2</text><polygon fill="#A80036" points="928.5,765.2188,938.5,769.2188,928.5,773.2188,932.5,769.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="934.5" y1="769.2188" y2="769.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="781.5" y="764.1528">get IK from cache</text><polygon fill="#A80036" points="200,794.3516,190,798.3516,200,802.3516,196,798.3516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="194" x2="773.5" y1="798.3516" y2="798.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="206" y="793.2856">complete operation 2</text><polygon fill="#A80036" points="762.5,848.4844,772.5,852.4844,762.5,856.4844,766.5,852.4844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="768.5" y1="852.4844" y2="852.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="196" y="847.4185">close session</text><polygon fill="#A80036" points="531,877.6172,521,881.6172,531,885.6172,527,881.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="525" x2="773.5" y1="881.6172" y2="881.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="537" y="876.5513">cache session</text><polygon fill="#A80036" points="45,906.75,35,910.75,45,914.75,41,910.75" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="39" x2="188" y1="910.75" y2="910.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="51" y="905.6841">API call User 1 result</text><polygon fill="#A80036" points="177,985.8828,187,989.8828,177,993.8828,181,989.8828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="34" x2="183" y1="989.8828" y2="989.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="41" y="984.8169">API call User 2</text><polygon fill="#A80036" points="334,1015.0156,344,1019.0156,334,1023.0156,338,1019.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="340" y1="1019.0156" y2="1019.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="196" y="1013.9497">create new session</text><polygon fill="#A80036" points="762.5,1044.1484,772.5,1048.1484,762.5,1052.1484,766.5,1048.1484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="520" x2="768.5" y1="1048.1484" y2="1048.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="527" y="1043.0825">get cached session</text><polygon fill="#A80036" points="762.5,1073.2813,772.5,1077.2813,762.5,1081.2813,766.5,1077.2813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="768.5" y1="1077.2813" y2="1077.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="196" y="1072.2153">operation 1</text><polygon fill="#A80036" points="1020.5,1102.4141,1030.5,1106.4141,1020.5,1110.4141,1024.5,1106.4141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="1026.5" y1="1106.4141" y2="1106.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="781.5" y="1101.3481">fetch IK</text><polygon fill="#A80036" points="643.5,1131.5469,633.5,1135.5469,643.5,1139.5469,639.5,1135.5469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="637.5" x2="773.5" y1="1135.5469" y2="1135.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="649.5" y="1130.481">get SK from cache</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="816.5" y1="1164.6797" y2="1164.6797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="816.5" x2="816.5" y1="1164.6797" y2="1177.6797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="775.5" x2="816.5" y1="1177.6797" y2="1177.6797"/><polygon fill="#A80036" points="785.5,1173.6797,775.5,1177.6797,785.5,1181.6797,781.5,1177.6797" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="781.5" y="1159.6138">decrypt IK with SK</text><polygon fill="#A80036" points="928.5,1202.8125,938.5,1206.8125,928.5,1210.8125,932.5,1206.8125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="934.5" y1="1206.8125" y2="1206.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="781.5" y="1201.7466">cache IK</text><polygon fill="#A80036" points="200,1231.9453,190,1235.9453,200,1239.9453,196,1235.9453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="194" x2="773.5" y1="1235.9453" y2="1235.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="206" y="1230.8794">complete operation 1</text><polygon fill="#A80036" points="762.5,1286.0781,772.5,1290.0781,762.5,1294.0781,766.5,1290.0781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="768.5" y1="1290.0781" y2="1290.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="196" y="1285.0122">close session</text><polygon fill="#A80036" points="531,1315.2109,521,1319.2109,531,1323.2109,527,1319.2109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="525" x2="773.5" y1="1319.2109" y2="1319.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="537" y="1314.145">cache session</text><polygon fill="#A80036" points="45,1344.3438,35,1348.3438,45,1352.3438,41,1348.3438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="39" x2="188" y1="1348.3438" y2="1348.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="51" y="1343.2778">API call User 2 result</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="388" y1="1442.6094" y2="1442.6094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="388" x2="388" y1="1442.6094" y2="1455.6094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="388" y1="1455.6094" y2="1455.6094"/><polygon fill="#A80036" points="357,1451.6094,347,1455.6094,357,1459.6094,353,1455.6094" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="353" y="1422.4106">session cache</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="353" y="1437.5435">expire timeout triggered</text><polygon fill="#A80036" points="498,1480.7422,508,1484.7422,498,1488.7422,502,1484.7422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="504" y1="1484.7422" y2="1484.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="353" y="1479.6763">expire session</text><polygon fill="#A80036" points="933.5,1509.875,943.5,1513.875,933.5,1517.875,937.5,1513.875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="774.5" x2="939.5" y1="1513.875" y2="1513.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="781.5" y="1508.8091">securely close IK cache</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="936.5" x2="954.5" y1="1504.875" y2="1522.875"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="936.5" x2="954.5" y1="1522.875" y2="1504.875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="231" y1="1568.0078" y2="1568.0078"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="231" x2="231" y1="1568.0078" y2="1581.0078"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="190" x2="231" y1="1581.0078" y2="1581.0078"/><polygon fill="#A80036" points="200,1577.0078,190,1581.0078,200,1585.0078,196,1581.0078" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="196" y="1562.9419">shutdown initiated</text><polygon fill="#A80036" points="334,1606.1406,344,1610.1406,334,1614.1406,338,1610.1406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="340" y1="1610.1406" y2="1610.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="196" y="1605.0747">close session factory</text><polygon fill="#A80036" points="615.5,1635.2734,625.5,1639.2734,615.5,1643.2734,619.5,1639.2734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="621.5" y1="1639.2734" y2="1639.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="353" y="1634.2075">securely close SK cache</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="618.5" x2="636.5" y1="1630.2734" y2="1648.2734"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="618.5" x2="636.5" y1="1648.2734" y2="1630.2734"/><polygon fill="#A80036" points="503,1664.4063,513,1668.4063,503,1672.4063,507,1668.4063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="346" x2="509" y1="1668.4063" y2="1668.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="353" y="1663.3403">close Session cache</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="506" x2="524" y1="1659.4063" y2="1677.4063"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="506" x2="524" y1="1677.4063" y2="1659.4063"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="231" y1="1697.5391" y2="1697.5391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="231" x2="231" y1="1697.5391" y2="1710.5391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="190" x2="231" y1="1710.5391" y2="1710.5391"/><polygon fill="#A80036" points="200,1706.5391,190,1710.5391,200,1714.5391,196,1710.5391" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="196" y="1692.4731">shutdown completes</text><rect fill="#DDDDDD" height="79.1875" rx="5" ry="5" style="stroke: #000000; stroke-width: 1.0;" width="305" x="11" y="1798.8359"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="22" y="1818.8311">Type</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="71" y="1818.8311">Description</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="21" y="1835.1279">MK</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="209" x="70" y="1835.1279">Master Key, root key from KMS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="18" x="21" y="1851.4248">SK</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="203" x="70" y="1851.4248">System Key, encrypted by MK</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="12" x="21" y="1867.7217">IK</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="236" x="70" y="1867.7217">Intermediate Key, encrypted by SK</text><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="310" y1="1805.8359" y2="1805.8359"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="310" y1="1822.1328" y2="1822.1328"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="310" y1="1838.4297" y2="1838.4297"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="310" y1="1854.7266" y2="1854.7266"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="310" y1="1871.0234" y2="1871.0234"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="17" y1="1805.8359" y2="1871.0234"/><line style="stroke: #000000; stroke-width: 1.0;" x1="66" x2="66" y1="1805.8359" y2="1871.0234"/><line style="stroke: #000000; stroke-width: 1.0;" x1="310" x2="310" y1="1805.8359" y2="1871.0234"/><!--MD5=[68518216435f2c25a30063106ea353dc]
@startuml

skinparam shadowing false

legend left
|= Type |= Description |
| MK | Master Key, root key from KMS |
| SK | System Key, encrypted by MK |
| IK | Intermediate Key, encrypted by SK |
endlegend

participant Caller
participant API
boundary SessionFactory
collections "Session Cache"
collections "SK Cache"
boundary Session
collections "IK Cache"
database Metastore
entity KMS

API -> API : startup initiated
API -> SessionFactory : create new factory
SessionFactory -> "Session Cache" : create new \nSession cache
activate "Session Cache"
SessionFactory -> "SK Cache" : create new \nSK cache
activate "SK Cache"
API -> API : startup completes
|||
Caller -> API : API call User 1
API -> SessionFactory : create new session
SessionFactory -> "Session Cache" : cache session
SessionFactory -> Session : create new instance
Session -> "IK Cache" : create new IK cache
activate "IK Cache"
API -> Session : operation 1
Session -> Metastore : fetch IK
Session -> Metastore : fetch SK
Session -> KMS : decrypt SK with MK
Session -> "SK Cache" : cache SK
Session -> Session : decrypt IK with SK
Session -> "IK Cache" : cache IK
Session -> API : complete operation 1
|||
API -> Session : operation 2
Session -> "IK Cache" : get IK from cache
Session -> API : complete operation 2
|||
API -> Session : close session
Session -> "Session Cache" : cache session
deactivate "IK Cache"
API -> Caller : API call User 1 result
|||
|||
Caller -> API : API call User 2
API -> SessionFactory : create new session
"Session Cache" -> Session : get cached session
activate "IK Cache"
API -> Session : operation 1
Session -> Metastore : fetch IK
Session -> "SK Cache" : get SK from cache
Session -> Session : decrypt IK with SK
Session -> "IK Cache" : cache IK
Session -> API : complete operation 1
|||
API -> Session : close session
Session -> "Session Cache" : cache session
deactivate "IK Cache"
API -> Caller : API call User 2 result
|||
|||
SessionFactory -> SessionFactory : session cache \nexpire timeout triggered
SessionFactory -> "Session Cache" : expire session
Session -> "IK Cache" : securely close IK cache
destroy "IK Cache"
|||
API -> API : shutdown initiated
API -> SessionFactory : close session factory
SessionFactory -> "SK Cache" : securely close SK cache
destroy "SK Cache"
SessionFactory -> "Session Cache" : close Session cache
destroy "Session Cache"
API -> API : shutdown completes

@enduml

PlantUML version 1.2019.11(Sun Sep 22 10:02:15 GMT 2019)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 14-ea+15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>